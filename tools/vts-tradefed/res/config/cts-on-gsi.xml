<?xml version="1.0" encoding="utf-8"?>
<!-- Copyright (C) 2016 The Android Open Source Project

     Licensed under the Apache License, Version 2.0 (the "License");
     you may not use this file except in compliance with the License.
     You may obtain a copy of the License at

          http://www.apache.org/licenses/LICENSE-2.0

     Unless required by applicable law or agreed to in writing, software
     distributed under the License is distributed on an "AS IS" BASIS,
     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     See the License for the specific language governing permissions and
     limitations under the License.
-->
<configuration description="Runs a subset of CTS tests using a general system image (GSI)">
    <option name="dynamic-sharding" value="false" />
    <device_recovery class="com.android.tradefed.device.WaitDeviceRecovery" />
    <build_provider class="com.android.compatibility.common.tradefed.build.CompatibilityBuildProvider">
        <option name="url-suite-name-override" value="CTS" />
    </build_provider>
    <test class="com.android.compatibility.common.tradefed.testtype.CompatibilityTestMultiDevice" />
    <option name="compatibility:test-arg" value="com.android.tradefed.testtype.AndroidJUnitTest:rerun-from-file:true" />
    <option name="compatibility:test-arg" value="com.android.tradefed.testtype.AndroidJUnitTest:fallback-to-serial-rerun:false" />
    <option name="compatibility:test-arg" value="com.android.compatibility.testtype.LibcoreTest:rerun-from-file:true" />
    <option name="compatibility:test-arg" value="com.android.compatibility.testtype.LibcoreTest:fallback-to-serial-rerun:false" />

    <logger class="com.android.tradefed.log.FileLogger">
        <option name="log-level-display" value="WARN" />
    </logger>
    <result_reporter class="com.android.compatibility.common.tradefed.result.ConsoleReporter" />
    <result_reporter class="com.android.compatibility.common.tradefed.result.VtsResultReporter" />

    <include name="cts-preconditions" />
    <option name="dynamic-config-pusher:dynamic-resource-name" value="vts-tradefed" />
    <include name="cts-system-checkers" />
    <include name="cts-known-failures" />

    <option name="test-tag" value="cts" />

    <option name="enable-root" value="false" />
    <!-- retain 200MB of host log -->
    <option name="max-log-size" value="200" />
    <!--  retain 200MB of logcat -->
    <option name="max-tmp-logcat-file" value="209715200" />

    <target_preparer class="com.android.tradefed.targetprep.RunCommandTargetPreparer">
        <option name="run-command" value="settings put global package_verifier_enable 0" />
        <option name="teardown-command" value="settings put global package_verifier_enable 1"/>
    </target_preparer>

    <target_preparer class="com.android.compatibility.common.tradefed.targetprep.PropertyCheck">
        <option name="property-name" value="ro.build.type" />
        <option name="expected-value" value="user"/> <!-- Device should have user build -->
        <option name="throw-error" value="false"/> <!-- Only print warning if not user build -->
    </target_preparer>

    <target_preparer class="com.android.compatibility.common.tradefed.targetprep.PropertyCheck">
        <option name="property-name" value="ro.product.locale" />
        <option name="expected-value" value="en-US"/> <!-- Device locale should be US English -->
        <option name="throw-error" value="false"/> <!-- Only print warning if not en-US -->
    </target_preparer>
    <template-include name="reporters" default="basic-reporters" />

    <!-- Include additional test metadata output. -->
    <template-include name="metadata-reporters" default="empty" />
    <target_preparer class="com.android.tradefed.targetprep.VtsDeviceInfoCollector">
         <option name="disable-framework" value="false"/>
    </target_preparer>

    <option name="plan" value="cts-on-gsi" />

    <option name="compatibility:primary-abi-only" value="true" />

    <!-- Tell all AndroidJUnitTests to exclude certain annotations -->
    <option name="compatibility:test-arg" value="com.android.tradefed.testtype.AndroidJUnitTest:exclude-annotation:android.platform.test.annotations.RestrictedBuildTest" />

    <!-- Tell all HostTests to exclude certain annotations -->
    <option name="compatibility:test-arg" value="com.android.tradefed.testtype.HostTest:exclude-annotation:android.platform.test.annotations.RestrictedBuildTest" />
    <option name="compatibility:test-arg" value="com.android.compatibility.common.tradefed.testtype.JarHostTest:exclude-annotation:android.platform.test.annotations.RestrictedBuildTest" />

    <!-- Explicitly include CTS components listed in CtsConfigLoadingTest.java -->
    <option name="compatibility:module-metadata-include-filter" key="component" value="abuse" />
    <option name="compatibility:module-metadata-include-filter" key="component" value="art" />
    <option name="compatibility:module-metadata-include-filter" key="component" value="auth" />
    <option name="compatibility:module-metadata-include-filter" key="component" value="auto" />
    <option name="compatibility:module-metadata-include-filter" key="component" value="backup" />
    <option name="compatibility:module-metadata-include-filter" key="component" value="bionic" />
    <option name="compatibility:module-metadata-include-filter" key="component" value="bluetooth" />
    <option name="compatibility:module-metadata-include-filter" key="component" value="camera" />
    <option name="compatibility:module-metadata-include-filter" key="component" value="deqp" />
    <option name="compatibility:module-metadata-include-filter" key="component" value="devtools" />
    <option name="compatibility:module-metadata-include-filter" key="component" value="framework" />
    <option name="compatibility:module-metadata-include-filter" key="component" value="graphics" />
    <option name="compatibility:module-metadata-include-filter" key="component" value="inputmethod" />
    <option name="compatibility:module-metadata-include-filter" key="component" value="libcore" />
    <option name="compatibility:module-metadata-include-filter" key="component" value="location" />
    <option name="compatibility:module-metadata-include-filter" key="component" value="media" />
    <option name="compatibility:module-metadata-include-filter" key="component" value="metrics" />
    <option name="compatibility:module-metadata-include-filter" key="component" value="misc" />
    <option name="compatibility:module-metadata-include-filter" key="component" value="networking" />
    <option name="compatibility:module-metadata-include-filter" key="component" value="neuralnetworks" />
    <option name="compatibility:module-metadata-include-filter" key="component" value="renderscript" />
    <option name="compatibility:module-metadata-include-filter" key="component" value="security" />
    <option name="compatibility:module-metadata-include-filter" key="component" value="statsd" />
    <option name="compatibility:module-metadata-include-filter" key="component" value="systems" />
    <option name="compatibility:module-metadata-include-filter" key="component" value="sysui" />
    <option name="compatibility:module-metadata-include-filter" key="component" value="telecom" />
    <option name="compatibility:module-metadata-include-filter" key="component" value="tv" />
    <option name="compatibility:module-metadata-include-filter" key="component" value="uitoolkit" />
    <option name="compatibility:module-metadata-include-filter" key="component" value="vr" />
    <option name="compatibility:module-metadata-include-filter" key="component" value="webview" />

    <!-- Radio system of a general system image is not checked -->
    <option name="compatibility:exclude-filter" value="CtsTelephonyTestCases" />
    <option name="compatibility:exclude-filter" value="CtsTelephony2TestCases" />
    <option name="compatibility:exclude-filter" value="CtsAppTestCases android.app.cts.SystemFeaturesTest#testLocationFeatures" />
    <option name="compatibility:exclude-filter" value="CtsIncidentHostTestCases com.android.server.cts.PackageIncidentTest#testPackageServiceDump" />

    <!-- Exclude telephony related testcases -->
    <option name="compatibility:exclude-filter" value="CtsCarrierApiTestCases android.carrierapi.cts.CarrierApiTest#testGetIccAuthentication" />
    <option name="compatibility:exclude-filter" value="CtsCarrierApiTestCases android.carrierapi.cts.CarrierApiTest#testHasCarrierPrivileges" />
    <option name="compatibility:exclude-filter" value="CtsCarrierApiTestCases android.carrierapi.cts.CarrierApiTest#testSendDialerSpecialCode" />
    <option name="compatibility:exclude-filter" value="CtsJobSchedulerTestCases android.jobscheduler.cts.ConnectivityConstraintTest#testConnectivityConstraintExecutes_metered" />
    <option name="compatibility:exclude-filter" value="CtsNetTestCasesLegacyApi22 android.net.cts.legacy.api22.ConnectivityManagerLegacyTest#testStartUsingNetworkFeature_enableHipri" />
    <option name="compatibility:exclude-filter" value="CtsPermission2TestCases android.permission2.cts.NoReceiveSmsPermissionTest#testAppSpecificSmsToken" />
    <option name="compatibility:exclude-filter" value="CtsPermission2TestCases android.permission2.cts.NoReceiveSmsPermissionTest#testReceiveTextMessage" />
    <option name="compatibility:exclude-filter" value="CtsPermissionTestCases android.permission.cts.NoSystemFunctionPermissionTest#testSendSms" />
    <option name="compatibility:exclude-filter" value="CtsSecurityHostTestCases android.security.cts.SELinuxHostTest#testNoExemptionsForBinderInVendorBan" />
    <option name="compatibility:exclude-filter" value="CtsSecurityHostTestCases android.security.cts.SELinuxHostTest#testNoExemptionsForSocketsBetweenCoreAndVendorBan" />
    <option name="compatibility:exclude-filter" value="CtsSecurityHostTestCases android.security.cts.SELinuxHostTest#testNoExemptionsForVendorExecutingCore" />
    <option name="compatibility:exclude-filter" value="CtsUsageStatsTestCases android.app.usage.cts.NetworkUsageStatsTest#testAppDetails" />
    <option name="compatibility:exclude-filter" value="CtsUsageStatsTestCases android.app.usage.cts.NetworkUsageStatsTest#testAppSummary" />
    <option name="compatibility:exclude-filter" value="CtsUsageStatsTestCases android.app.usage.cts.NetworkUsageStatsTest#testCallback" />
    <option name="compatibility:exclude-filter" value="CtsUsageStatsTestCases android.app.usage.cts.NetworkUsageStatsTest#testDeviceSummary" />
    <option name="compatibility:exclude-filter" value="CtsUsageStatsTestCases android.app.usage.cts.NetworkUsageStatsTest#testTagDetails" />
    <option name="compatibility:exclude-filter" value="CtsUsageStatsTestCases android.app.usage.cts.NetworkUsageStatsTest#testUidDetails" />
    <option name="compatibility:exclude-filter" value="CtsUsageStatsTestCases android.app.usage.cts.NetworkUsageStatsTest#testUserSummary" />

    <!-- Exclude not applicable testcases-->
    <option name="compatibility:exclude-filter" value="CtsSignatureTestCases" />
    <option name="compatibility:exclude-filter" value="CtsOsTestCases android.os.cts.UsbDebuggingTest#testUsbDebugging" />

    <!--
        Exclude Webkit related testcases
        TODO(jaekyun@): b/63600240, Webkit related testcases will be revived when the RRO packaging logic is revised so that we can selectively compose a RRO from overlays.
    -->
    <option name="compatibility:exclude-filter" value="CtsWebkitTestCases" />
    <option name="compatibility:exclude-filter" value="CtsAppSecurityHostTestCases android.appsecurity.cts.EphemeralTest#testWebViewLoads" />
    <option name="compatibility:exclude-filter" value="CtsAssistTestCases android.assist.cts.WebViewTest#testWebView" />
    <option name="compatibility:exclude-filter" value="CtsHostsideWebViewTests com.android.cts.webkit.WebViewHostSideStartupTest#testCookieManager" />
    <option name="compatibility:exclude-filter" value="CtsHostsideWebViewTests com.android.cts.webkit.WebViewHostSideStartupTest#testStrictMode" />
    <option name="compatibility:exclude-filter" value="CtsHostsideWebViewTests com.android.cts.webkit.WebViewHostSideStartupTest#testWebViewVersionApi" />
    <option name="compatibility:exclude-filter" value="CtsHostsideWebViewTests com.android.cts.webkit.WebViewHostSideStartupTest#testWebViewVersionApiOnUiThread" />
    <option name="compatibility:exclude-filter" value="CtsTextTestCases android.text.cts.EmojiTest#testEmojiGlyph" />
    <option name="compatibility:exclude-filter" value="CtsTextTestCases android.text.util.cts.LinkifyTest#testAddLinks_doesNotAddLinksForUrlWithoutProtocolAndWithoutKnownTld" />
    <option name="compatibility:exclude-filter" value="CtsUiRenderingTestCases android.uirendering.cts.testclasses.PathClippingTests#testWebViewClipWithCircle" />
    <option name="compatibility:exclude-filter" value="CtsWidgetTestCases android.widget.cts.TextViewTest#testAccessAutoLinkMask" />
    <option name="compatibility:exclude-filter" value="CtsWidgetTestCases android.widget.cts.TextViewTest#testAppend_addsLinkIfAppendedTextCompletesPartialUrlAtTheEndOfExistingText" />
    <option name="compatibility:exclude-filter" value="CtsWidgetTestCases android.widget.cts.TextViewTest#testAppend_addsLinkIfAppendedTextUpdatesUrlAtTheEndOfExistingText" />
    <option name="compatibility:exclude-filter" value="CtsWidgetTestCases android.widget.cts.TextViewTest#testAppend_addsLinksEvenWhenThereAreUrlsSetBefore" />
    <option name="compatibility:exclude-filter" value="CtsWidgetTestCases android.widget.cts.TextViewTest#testAppend_addsLinksWhenAutoLinkIsEnabled" />
    <option name="compatibility:exclude-filter" value="CtsWidgetTestCases android.widget.cts.TextViewTest#testAppend_addsLinksWhenTextIsSpannableAndContainsUrlAndAutoLinkIsEnabled" />
    <option name="compatibility:exclude-filter" value="CtsWidgetTestCases android.widget.cts.TextViewTest#testAppend_doesNotAddLinksWhenAppendedTextDoesNotContainLinks" />
    <option name="compatibility:exclude-filter" value="CtsWidgetTestCases android.widget.cts.TextViewTest#testAppend_setsMovementMethodWhenTextContainsUrlAndAutoLinkIsEnabled" />

    <!--
        Exclude testcases failing on AOSP Pixel system.img
        TODO(jaeshin@): b/63302562, Track future fixes to AOSP Pixel system.img and revive these testcases accordingly.
    -->
    <option name="compatibility:exclude-filter" value="CtsAppSecurityHostTestCases android.appsecurity.cts.EphemeralTest#testExposedSystemActivities" />
    <option name="compatibility:exclude-filter" value="CtsContentTestCases android.content.cts.AvailableIntentsTest#testVoiceCommand" />
    <option name="compatibility:exclude-filter" value="CtsContentTestCases android.content.cts.AvailableIntentsTest#testVoiceSearchHandsFree" />
    <option name="compatibility:exclude-filter" value="CtsPermission2TestCases android.permission2.cts.PrivappPermissionsTest#testPrivappPermissionsEnforcement" />
    <option name="compatibility:exclude-filter" value="CtsVideoTestCases android.video.cts.VideoEncoderDecoderTest#testVp8Other0Qual1920x1080" />

    <!--
        Exclude Verity tese cases, because we need to disable Verity to test with GSI
    -->
    <option name="compatibility:exclude-filter" value="CtsKeystoreTestCases android.keystore.cts.KeyAttestationTest#testEcAttestation" />
    <option name="compatibility:exclude-filter" value="CtsKeystoreTestCases android.keystore.cts.KeyAttestationTest#testRsaAttestation" />

    <!-- Exclude test cases for b/64488375
    -->

    <option name="compatibility:exclude-filter" value="CtsContentTestCases android.content.cts.AvailableIntentsTest#testVoiceCommand" />
    <option name="compatibility:exclude-filter" value="CtsContentTestCases android.content.cts.AvailableIntentsTest#testVoiceSearchHandsFree" />

    <option name="compatibility:exclude-filter" value="CtsJobSchedulerTestCases android.jobscheduler.cts.ConnectivityConstraintTest#testConnectivityConstraintExecutes_metered" />

    <option name="compatibility:exclude-filter" value="CtsNetTestCasesLegacyApi22 android.net.cts.legacy.api22.ConnectivityManagerLegacyTest#testStartUsingNetworkFeature_enableHipri" />

    <option name="compatibility:exclude-filter" value="CtsPermissionTestCases android.permission.cts.NoSystemFunctionPermissionTest#testSendSms" />

    <option name="compatibility:exclude-filter" value="CtsPermission2TestCases android.permission2.cts.NoReceiveSmsPermissionTest#testAppSpecificSmsToken" />
    <option name="compatibility:exclude-filter" value="CtsPermission2TestCases android.permission2.cts.NoReceiveSmsPermissionTest#testReceiveTextMessage" />
    <option name="compatibility:exclude-filter" value="CtsPermission2TestCases android.permission2.cts.PrivappPermissionsTest#testPrivappPermissionsEnforcement" />

    <option name="compatibility:exclude-filter" value="CtsContentTestCases android.signature.cts.IntentTest#shouldNotFindUnexpectedIntents" />

    <option name="compatibility:exclude-filter" value="CtsTextTestCases android.text.cts.EmojiTest#testEmojiGlyph" />
    <option name="compatibility:exclude-filter" value="CtsTextTestCases android.text.util.cts.LinkifyTest#testAddLinks_doesNotAddLinksForUrlWithoutProtocolAndWithoutKnownTld" />

    <option name="compatibility:exclude-filter" value="CtsUiRenderingTestCases android.uirendering.cts.testclasses.PathClippingTests#testWebViewClipWithCircle" />

    <option name="compatibility:exclude-filter" value="CtsWebkitTestCases android.webkit.cts.WebViewClientTest#testOnUnhandledKeyEvent" />
    <option name="compatibility:exclude-filter" value="CtsWebkitTestCases android.webkit.cts.WebViewTest#testFindAll" />
    <option name="compatibility:exclude-filter" value="CtsWebkitTestCases android.webkit.cts.WebViewTest#testFindNext" />
    <option name="compatibility:exclude-filter" value="CtsWebkitTestCases android.webkit.cts.WebViewTest#testFlingScroll" />
    <option name="compatibility:exclude-filter" value="CtsWebkitTestCases android.webkit.cts.WebViewTest#testGetContentHeight" />
    <option name="compatibility:exclude-filter" value="CtsWebkitTestCases android.webkit.cts.WebViewTest#testGetHitTestResult" />
    <option name="compatibility:exclude-filter" value="CtsWebkitTestCases android.webkit.cts.WebViewTest#testPageScroll" />
    <option name="compatibility:exclude-filter" value="CtsWebkitTestCases android.webkit.cts.WebViewTest#testRequestFocusNodeHref" />
    <option name="compatibility:exclude-filter" value="CtsWebkitTestCases android.webkit.cts.WebViewTest#testRequestImageRef" />

    <!-- b/65561379: Exclude android.media.cts.MediaPlayerFlakyNetworkTest -->
    <option name="compatibility:exclude-filter" value="CtsMediaTestCases android.media.cts.MediaPlayerFlakyNetworkTest" />

</configuration>
